import Box from '@mui/material/Box';
import { observer } from "mobx-react-lite";
import { useEffect, useState } from 'react';
import { useStores } from "../../../models/root-store/root-store-context"
import {
  Accordion as MuiAccrodion,
  AccordionDetails as MuiAccordionDetails,
  AccordionSummary as MuiAccordionSummary,
  styled,
  alpha, Button, Dialog, Divider, Skeleton, Slide, Stack, Typography, useTheme, TooltipProps, Tooltip, tooltipClasses, LinearProgress
} from '@mui/material';
import { useLocation, useNavigate } from 'react-router';
import { pxToRem } from 'src/theme/typography';
import { Share } from 'src/screens/contents/share/Share';
import ExpandMoreIcon from '@mui/icons-material/ExpandMore';
import { makeStyles } from '@material-ui/core/styles';
import moment from 'moment';
import Countdown, { CountdownApi, CountdownRenderProps, zeroPad } from 'react-countdown';
import React from 'react';
import { TransitionProps } from '@mui/material/transitions';
import Prize from '../prize/Prize';
import { useAuthContext } from 'src/auth/useAuthContext';
import { CallApiToStore } from 'src/utils/common';
import { PATH_AUTH, PATH_ROOT } from 'src/routes/paths';
import { Icon } from '@iconify/react';
import CHeader from 'src/components/CHeader';
import { toJS } from 'mobx';
import Image from 'src/components/image';
import fcfsBanner from '../../../assets/images/fcfsBanner.jpg'
import fcfsMarket from '../../../assets/images/fcfsMarket.jpg'
import fcfsFcfs from '../../../assets/images/fcfsFcfs.jpg'
import fcfsGun from '../../../assets/images/fcfsGun.jpg'
import fcfsShareBg from '../../../assets/images/fcfsShareBg.jpg'
import Footer from 'src/screens/home/footer/Footer';
import FamilySite from 'src/screens/home/family-site/FamilySite';
import FcfsMarket from './fcfs-maket/FcfsMarket';
import FcfsMarketCard from './fcfs-maket/FcfsMarketGoldCard';
import { ReactComponent as FaqQ } from 'src/assets/icons/faq-q.svg';
import { ReactComponent as Logo } from 'src/assets/images/gentok-logo-white.svg';

// flipClock
import FlipClockCountdown from '@leenguyen/react-flip-clock-countdown';
import './flipclock2.css';


/**
 * ## Fcfs ÏÑ§Î™Ö
 *
 */
type Props = {
  handleClose: VoidFunction;
}
export const Fcfs = observer(() => {

  const rootStore = useStores();
  const { eventStore, loadingStore, responseStore, homeStore } = rootStore;
  const theme = useTheme();
  const { REACT_APP_API_URL, REACT_APP_IMAGE_STORAGE } = process.env;
  const [openAlert, setOpenAlert] = useState(false)
  const [alertMsg, setAlertMsg] = useState(false)
  const { user, isAuthenticated } = useAuthContext();

  const navigate = useNavigate();
  const [event, setEvent] = useState<any>(eventStore.event);

  const options: any = {
    showMainIcon: 'back',
    handleMainIcon: () => {
      navigate(-1);
    },
    showHomeIcon: true,
    handleX: () => {
      navigate(-1)
    }
  };
  const END_TIME = '23:59:59';

  const getEvent = async () => {
    CallApiToStore(eventStore.get(101), 'api', loadingStore).then(() => {
      eventStore.pagination_all.setProps({ size: 10 });
      // ÏûÑÏãú ÌÉúÏä§Ìä∏Ïö©
      // event.setProps({
      //   startTime: moment().add(5, 'seconds').format('HH:mm:ss'),
      // });
      setEvent(toJS(eventStore.event));
      console.log(toJS(event));

    });
  };

  useEffect(() => {
    if (eventStore.event.eventSid !== 101) {
      getEvent()
    }
  }, [])

  const [openLoading, setOpenLoading] = useState(false);
  const [openResult, setOpenResult] = useState(false);
  const [resultData, setResultData] = useState();


  const getCoupon = () => {
    if (!isAuthenticated) {
      // navigate(PATH_AUTH.login, { state: `${PATH_ROOT.event.fcfs}` });
      sessionStorage.setItem('afterUrl', '/event/fcfs');
      navigate(PATH_AUTH.login);
      return;
    }
    setOpenLoading(true);

    // !apply
    fetch(REACT_APP_API_URL + `/common/v1/fcfs/101/apply`, {
      method: 'GET',
      headers: {
        'Authorization': localStorage.getItem('accessToken') ? 'Bearer ' + localStorage.getItem('accessToken') : ''
      }
    })
      .then(async (res) => {

        const json = await res.json();
        // ÏÑ†Ï∞©Ïàú ÌÜµÍ≥º
        if (json.resultCode === 'S') {
          getRank();
        }
        // ÏÑ†Ï∞©Ïàú ÎßàÍ∞ê(9001) ÎòêÎäî Ïù¥ÎØ∏ Ï∞∏Ïó¨(9002)
        else if (json.resultCode === 'F' &&
          (
            json.errorCode === 'EVENT-9001' || // ÎßàÍ∞ê -> ÏïÑÏâ¨ÏõåÏöî
            json.errorCode === 'EVENT-9002' || // Ïù¥ÎØ∏ Ï∞∏Ïó¨
            json.errorCode === 'EVENT-9003 ' // Ïù¥ÎØ∏ ÎãπÏ≤®
          )) {
          setOpenLoading(false);
          setOpenResult(true);
          setResultData(json)
        } else {
          setOpenLoading(false);
          setAlertMsg(json.errorMessage)
          setOpenAlert(true);
        }
      })
      .catch((e) => {
        console.log('üåà ~ getCoupon ~ e apply:', e);
      });

    // !rank
    const getRank = () => fetch(REACT_APP_API_URL + `/common/v1/fcfs/101/rank`, {
      method: 'GET',
      headers: {
        'Authorization': localStorage.getItem('accessToken') ? 'Bearer ' + localStorage.getItem('accessToken') : ''
      }
    }).then(async (res) => {
      const json = await res.json();
      // ÏÑ†Ï∞©Ïàú ÌÜµÍ≥º
      if (json.resultCode === 'S') {
        const passKey = json.data.passKey;
        if (passKey) {
          getAction(passKey)
        } else {
          setTimeout(getRank, 1000)
        }
      }
    }).catch((e) => {
      console.log('üåà ~ getCoupon ~ e rank:', e)
    })

    // !action
    const getAction = (passKey: any) => fetch(REACT_APP_API_URL + `/common/v1/fcfs/101/action?passKey=${passKey}`, {
      method: 'GET',
      headers: {
        'Authorization': localStorage.getItem('accessToken') ? 'Bearer ' + localStorage.getItem('accessToken') : ''
      }
    }).then(async (res) => {
      const json = await res.json();
      setOpenLoading(false);
      if (json.resultCode === 'S') {
        setOpenResult(true); // ÎãπÏ≤® | ÎãπÏ≤®X
        setResultData(json)
      } else {
        setAlertMsg(json.errorMessage)
        setOpenAlert(true);
      }
    }).catch((e) => {
      setOpenLoading(false);
      console.log('üåà ~ getCoupon ~ e action:', e)
    })
  }

  const [countdownApi, setCountdownApi] = useState<CountdownApi | null>(null);
  const setRef = (countdown: Countdown | null): void => {
    if (countdown) {
      setCountdownApi(countdown.getApi());
    }
  };

  const countdownRenderer = ({
    total,
    hours,
    minutes,
    seconds,
    completed,
    formatted,
  }: CountdownRenderProps) => {
    if (completed) {
      return (
        // <>
        //   {
        //     isAuthenticated ?
              <Button
                variant={'contained'}
                size={'large'}
                sx={{
                  // backgroundColor: theme.palette.common.white,
                  height: pxToRem(60),
                  maxWidth: 'md',
                  width: '100%',
                  borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
                  position: 'fixed',
                  bottom: 0,
                  overflow: 'hidden',
                  zIndex: 4,
                  // '&:hover':{
                  //   bgcolor:alpha('#fff', 0.8),
                  //   color:theme.palette.primary.main,
                  // }
                }}
                onClick={getCoupon}
              >
                {event.buttonNm}
                <Box component={Icon} icon={'ep:arrow-right-bold'} sx={{ pointer: 'cursor', ml: 1 }}></Box>
              </Button>
        //       :
        //       <BootstrapTooltip title={<><span style={{ color: '#FF7F3F' }}>Î°úÍ∑∏Ïù∏</span> ÌõÑ Ï∞∏Ïó¨Í∞Ä Í∞ÄÎä•Ìï¥Ïöî</>} open={true}>
        //         <Button
        //           variant={'contained'}
        //           size={'large'}
        //           sx={{
        //             // backgroundColor: theme.palette.common.white,
        //             height: pxToRem(60),
        //             maxWidth: 'md',
        //             width: '100%',
        //             borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
        //             position: 'fixed',
        //             bottom: 0,
        //             overflow: 'hidden',
        //             zIndex: 4,
        //             // '&:hover':{
        //             //   bgcolor:alpha('#fff', 0.8),
        //             //   color:theme.palette.primary.main,
        //             // }
        //           }}
        //           onClick={getCoupon}
        //         >
        //           {event.buttonNm}
        //           <Box component={Icon} icon={'ep:arrow-right-bold'} sx={{ pointer: 'cursor', ml: 1 }}></Box>
        //         </Button>
        //       </BootstrapTooltip>
        //   }
        // </>
      )
    } else if (countdownApi?.isStarted()) {
      return (
        <>
          {/* {
            isAuthenticated ?
              <Button
                variant={'contained'}
                size={'large'}
                disabled
                sx={{
                  height: pxToRem(60),
                  maxWidth: 'md',
                  width: '100%',
                  borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
                  position: 'fixed',
                  bottom: 0,
                  overflow: 'hidden',
                  zIndex: 4,
                }}
              >
                <Typography variant={'Kor_22_b'}>
                  {zeroPad(hours)}Ïãú {zeroPad(minutes)}Î∂Ñ {zeroPad(seconds)}Ï¥à ÎÇ®Ïùå
                </Typography>
              </Button>
              :
              <BootstrapTooltip title={<><span style={{ color: '#FF7F3F' }}>Î°úÍ∑∏Ïù∏</span> ÌõÑ Ï∞∏Ïó¨Í∞Ä Í∞ÄÎä•Ìï¥Ïöî</>} open={true}> */}
                <Button
                  variant={'contained'}
                  size={'large'}
                  // disabled
                  onClick={() => {
                    sessionStorage.setItem('afterUrl', '/event/fcfs')
                    navigate('/login', { replace: true });
                  }}
                  sx={{
                    background: 'rgb(198, 199, 202)',
                    color: '#FFFFFF',
                    height: pxToRem(60),
                    maxWidth: 'md',
                    width: '100%',
                    borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
                    position: 'fixed',
                    bottom: 0,
                    overflow: 'hidden',
                    zIndex: 4,
                  }}
                >
                  <Typography variant={'Kor_22_b'}>
                    {zeroPad(hours)}Ïãú {zeroPad(minutes)}Î∂Ñ {zeroPad(seconds)}Ï¥à ÎÇ®Ïùå
                  </Typography>
                </Button>
              {/* </BootstrapTooltip>
          } */}
        </>
      );
    }
  };

  const [isOpen, setIsOpen] = useState(false);
  const [remainTime, setRemainTime] = useState(0);
  useEffect(() => {
    let interval: any;

    const check = () => {
      const now = moment().format('YYYY-MM-DD HH:mm:ss');
      const startTime = moment(moment().format('YYYY-MM-DD') + ' ' + event.startTime);
      const endTime = moment(moment().format('YYYY-MM-DD') + ' ' + END_TIME);

      const open = moment(now).isBetween(startTime, endTime);
      if (!open) {
        clearInterval(interval);
        setIsOpen(open);
      }
    }
    if (isOpen) {
      interval = setInterval(check, 1000);
    }
    return () => {
      if (interval) {
        clearInterval(interval);
      }
    }
  }, [isOpen]);

  const [startTime, setStartTime] = useState<string | number | Date>(0);
  const [startTime1, setStartTime1] = useState<string | number | Date>(0);
  useEffect(() => {
    if (event.startTime) {

      const now = moment().format('YYYY-MM-DD HH:mm:ss');
      const startTime = moment(moment().format('YYYY-MM-DD') + ' ' + event.startTime);
      const endTime = moment(moment().format('YYYY-MM-DD') + ' ' + END_TIME);
      // const endTimeOri = moment(moment(startTime).add(1, 'minutes').format('YYYY-MM-DD') + ' ' + event.endTime);
      const endTimeOri = moment(moment(startTime).add(1, 'minutes'));


      const open = moment(now).isBetween(startTime, endTime);
      setIsOpen(isOpen => isOpen = open);
      setStartTime(startTime.format('YYYY-MM-DD HH:mm:ss'));

      // ÏãúÏûëÏ†ÑÏù¥Î©¥
      if (moment(now) < moment(startTime)) {
        setStartTime1(startTime1 => startTime1 = moment(startTime).format('YYYY-MM-DD HH:mm:ss'));
        // Ïù¥Î≤§Ìä∏ ÏãúÏûëÌõÑ 1Î∂ÑÌõÑ
        // } else if (moment(now) > moment(endTimeOri)) {
      } else {
        setStartTime1(startTime1 => startTime1 = moment(moment().format('YYYY-MM-DD') + ' ' + event.startTime).add(1, 'days').format('YYYY-MM-DD HH:mm:ss'));
      }

      if (!open) {
        const seconds = moment.duration(startTime.diff(now)).asSeconds();
        if (seconds < 0) {
          setRemainTime(moment.duration(moment(moment().add(1, 'days').format('YYYY-MM-DD') + ' ' + event.startTime).diff(now)).asSeconds() * 1000);
        } else {
          setRemainTime(seconds * 1000);
        }
      }
    }
  }, [event])


  const [flipCardWidth, setFlipCardWidth] = useState(46.5);
  const setFlipCardSize = () => {
    const el = document.getElementById('simple-layout');
    if (el) {
      setFlipCardWidth(flipCardWidth => flipCardWidth = (el?.clientWidth - 94) / 6);
    }
  }
  useEffect(() => {
    setFlipCardSize();
    window.addEventListener('resize', setFlipCardSize)
    return () => {
      window.removeEventListener('resize', setFlipCardSize)
    }
  }, [])

  const classes = useStyles();

  return (
    <>
      <Stack sx={{ mb: pxToRem(40) }}>
        <CHeader title={'Ïù¥Î≤§Ìä∏'} {...options} />

        {/* Î∞∞ÎÑà */}
        <Image src={fcfsBanner} />

        {/* ÎßàÏºì */}
        <Image src={fcfsMarket} />

        <FcfsMarket />

        {/* ÏÑ†Ï∞©Ïàú Ïù¥Î≤§Ìä∏ */}
        <Image src={fcfsFcfs} sx={{ lineHeight: 0 }} />

        {<Stack sx={{ pt: pxToRem(10), background: '#EA69A2', }}>
          <Stack direction={'row'} justifyContent={'space-between'} sx={{ px: '20px' }}>
            <Typography variant={'Kor_22_b'} sx={{ color: '#FFFFFF' }}>
              Ïò§ÌîàÍπåÏßÄ
            </Typography>
            <Typography variant={'Kor_14_b'} sx={{ color: '#FFFFFF', background: '#8A0D8C', p: '4px 8px' }}>
              Îß§Ïùº Ïò§Ï†Ñ10Ïãú 01Î∂Ñ ÏÑ†Ï∞©Ïàú Î¨¥Î£å
            </Typography>
          </Stack>
          <Box sx={{ p: '20px', textAlign: 'center', display: 'flex', justifyContent: 'center' }}>
            <FlipClockCountdown
              onComplete={() => {
                // setIsOpen(true)
              }}
              duration={0.7}
              renderMap={[false, true, true, true]}
              separatorStyle={{ color: 'black', size: '6px' }}
              showLabels={false}
              to={startTime1}
              // digitBlockStyle={{ width: 46.5, height: 70, fontSize: 38 }}
              digitBlockStyle={{ width: flipCardWidth, height: flipCardWidth * 1.5, fontSize: flipCardWidth * .8 }}
            />
          </Box>
        </Stack>}

        <Image src={fcfsGun} sx={{ lineHeight: 0 }} />

        {/* Í≥µÏú†ÌïòÍ∏∞ */}
        <Image src={fcfsShareBg} sx={{ lineHeight: 0 }} />
        <Stack
          sx={{ alignItems: 'center', pb: pxToRem(40), overflow: 'hidden', background: '#f6de6c' }}>
          <Box sx={{ background: '#FFFFFF', borderRadius: 5, textAlign: 'center', px: 2 }}>
            <Share
              shareData={{
                title: event.eventNm,
                desc: event.eventConts,
                path: 'event',
                type: 'Ïù¥Î≤§Ìä∏',
                Sid: event.eventSid,
                img: event.thumbnlPath ? REACT_APP_IMAGE_STORAGE + event.thumbnlPath : '',
                url: process.env.NODE_ENV === 'production' ? window.location.href + `?eventId=${event.eventSid}` : `https://devf2d.surfinn.kr/event?eventSid=${event.eventSid}`
              }}
              handleAlertClose={() => { }}
            />
          </Box>
        </Stack>

        <Stack sx={{ p: '20px', mt: '20px', textAlign: 'left' }}>
          <Typography variant={'Kor_20_b'}>ÏûêÏ£º Ï∞æÎäî ÏßàÎ¨∏</Typography>
          <Accordion square elevation={0} sx={{ width: '100%', borderRadius: '0 !important', pt: pxToRem(10), px: 0, boxShadow: 'none !important' }}>
            <AccordionSummary
              expandIcon={<ExpandMoreIcon sx={{ color: '#DFE0E2' }} />}
              aria-controls="panel1a-content">
              <FaqQ />
              <Typography variant={'Kor_14_b'} sx={{ ml: 1 }}>Ï††ÌÜ° Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨, Ïôú Î¨¥Î£åÎ°úÎèÑ Ï†úÍ≥µÌïòÎÇòÏöî?</Typography>
            </AccordionSummary>
            <AccordionDetails>
              <Typography variant={'Kor_14_r'} sx={{ color: '#5D6066' }}>
                Ï††ÌÜ° Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨ ÏÑúÎπÑÏä§Î•º Ï†úÍ≥µÌïòÎäî Í∏ÄÎ°úÎ≤å Ïú†Ï†ÑÏ≤¥ Î∂ÑÏÑù Ï†ÑÎ¨∏Í∏∞ÏóÖ ÎßàÌÅ¨Î°úÏ††Ïùò ÎØ∏ÏÖòÏùÄ Ï†ÑÏÑ∏Í≥Ñ Î™®ÎëêÏóêÍ≤å ‚ÄòÎÇ¥ Î™∏ ÏÑ§Í≥ÑÎèÑ‚ÄôÎ•º Ï†úÍ≥µÌïòÏó¨ Î≥¥Îã§ Í±¥Í∞ïÌïú ÏÑ∏ÏÉÅÏùÑ ÎßåÎìúÎäî Í≤ÉÏûÖÎãàÎã§. <br /><br />
                1997ÎÖÑ ÏÑ§Î¶ΩÎêú ÎßàÌÅ¨Î°úÏ††ÏùÄ Íµ≠ÎÇ¥ 1ÏúÑ Ïú†Ï†ÑÏ≤¥ Î∂ÑÏÑù Í∏∞ÏóÖÏúºÎ°ú, Ïù¥Ï†ÑÏóêÎäî Ïñ¥Î†µÍ≤å ÎäêÍª¥ÏßÄÍ≥† ÎπÑÏö© Î∂ÄÎã¥Ïù¥ ÏûàÏóàÎçò Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨Î•º ÏâΩÍ≥† Î∂ÄÎã¥ ÏóÜÏù¥ Î∞õÏùÑ Ïàò ÏûàÎèÑÎ°ù Ï†úÍ≥µÌïòÏó¨ Í∞ÅÏûê ÌÉÄÍ≥†ÎÇú Ïú†Ï†Ñ Ï†ïÎ≥¥Î•º Í∏∞Î∞òÏúºÎ°ú ÎòëÎòëÌïú Í±¥Í∞ïÍ¥ÄÎ¶¨Î•º Ìï† Ïàò ÏûàÍ≤å ÎèïÍ≥†Ïûê Ìï©ÎãàÎã§.
              </Typography>
            </AccordionDetails>
          </Accordion>
          <Accordion square elevation={0} sx={{ width: '100%', borderRadius: '0 !important', px: 0, boxShadow: 'none !important' }}>
            <AccordionSummary
              expandIcon={<ExpandMoreIcon sx={{ color: '#DFE0E2' }} />}
              aria-controls="panel1a-content">
              <FaqQ />
              <Typography variant={'Kor_14_b'} sx={{ ml: 1 }}>ÏÑ†Ï∞©Ïàú Ïã†Ï≤≠ÏùÄ Ïñ¥ÎñªÍ≤å ÌïòÎÇòÏöî?</Typography>
            </AccordionSummary>
            <AccordionDetails>
              <Typography variant={'Kor_14_r'} sx={{ color: '#5D6066' }}>
                Îß§Ïùº Ïò§Ï†Ñ 10Ïãú 01Î∂ÑÏóê Ïã†Ï≤≠Ïù¥ Ïò§ÌîàÎê©ÎãàÎã§. <br /><br />
                Î¨¥Î£å Í≤ÄÏÇ¨ Î∞õÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨ Î¨¥Î£å ÌòúÌÉùÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî. ÏÑ†Ï∞©Ïàú ÎãπÏ≤® Í≤∞Í≥ºÏóê Îî∞Îùº Î¨¥Î£å Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨Î•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.
              </Typography>
            </AccordionDetails>
          </Accordion>

          <Typography variant={'Kor_20_b'} sx={{ mt: '40px', pb: '10px' }}>Ïú†ÏùòÏÇ¨Ìï≠</Typography>

          <ul
            style={{
              ...theme.typography.Kor_12_r,
              margin: 0,
              paddingLeft: '1.5em',
              lineHeight: pxToRem(22),
              color: '#5D6066',
            }}
          >
            <li>Î≥∏ Ïù¥Î≤§Ìä∏Îäî Ï††ÌÜ° ÌöåÏõêÏóêÍ≤åÎßå Ï†úÍ≥µÎêòÎäî ÌäπÎ≥ÑÌïú ÏÑúÎπÑÏä§Î°ú, Ï††ÌÜ° ÌöåÏõêÏù¥ÎùºÎ©¥ ÎàÑÍµ¨ÎÇò Ï∞∏Ïó¨Ìï† Ïàò ÏûàÏñ¥Ïöî.</li>
            <li>Ï††ÌÜ° Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨ ÌÇ§Ìä∏, Î∂ÑÏÑù ÎπÑÏö©, ÏôïÎ≥µ ÌÉùÎ∞∞ÎπÑÍπåÏßÄ Í≤ÄÏÇ¨ Í¥ÄÎ†® Î™®Îì† ÎπÑÏö©ÏùÄ Î¨¥Î£åÏòàÏöî.</li>
            <li>Î∞úÌñâÎêú Ïø†Ìè∞ÏùÄ Î∞úÌñâÏùºÎ°úÎ∂ÄÌÑ∞ 7Ïùº Ïù¥ÎÇ¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.</li>
            <li>Î≥∏ Ïù¥Î≤§Ìä∏Îäî Í∞Å ÌöåÏõêÎãπ 1Ïùº 1ÌöåÎßå Ï∞∏Ïó¨ Í∞ÄÎä•ÌïòÎ©∞, Í≤ÄÏÇ¨ Î≥ÄÍ≤Ω Î∞è Ï≤†ÌöåÎäî Î∂àÍ∞ÄÎä•Ìï¥Ïöî.</li>
            <li>Î≥∏ Ïù¥Î≤§Ìä∏ ÎãπÏ≤® Ïãú, ÎßàÏù¥ÌéòÏù¥ÏßÄÏóêÏÑú Ïø†Ìè∞ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Ïú†Ï†ÑÏûê Í≤ÄÏÇ¨Î•º Î¨¥Î£å Ïã†Ï≤≠Ìï† Ïàò ÏûàÏñ¥Ïöî.</li>
            <li>Î≥∏ Ïù¥Î≤§Ìä∏Îäî ÎãπÏÇ¨ ÏÇ¨Ï†ïÏóê Îî∞Îùº ÏÇ¨Ï†Ñ Í≥†ÏßÄ ÏóÜÏù¥ Ï°∞Í∏∞ Ï¢ÖÎ£åÎêòÍ±∞ÎÇò Î≥ÄÎèôÏÇ¨Ìï≠Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÏñ¥Ïöî.</li>
          </ul>

        </Stack>

      </Stack>

      <Divider />
      <Footer />
      <FamilySite />
      <Stack >
        {
          !isOpen
            ?
            remainTime > 0 &&
            <Countdown
              key={'countdown-fcfs'}
              ref={setRef}
              date={Date.now() + remainTime}
              renderer={countdownRenderer}
              autoStart={true}
              onComplete={() => {
              }}
            />
            :
            isAuthenticated ?
              <Button
                variant={'contained'}
                size={'large'}
                sx={{
                  // backgroundColor: theme.palette.common.white,
                  height: pxToRem(60),
                  maxWidth: 'md',
                  width: '100%',
                  borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
                  position: 'fixed',
                  bottom: 0,
                  overflow: 'hidden',
                  zIndex: 4,
                  // '&:hover':{
                  //   bgcolor:alpha('#fff', 0.8),
                  //   color:theme.palette.primary.main,
                  // }
                }}
                onClick={getCoupon}
              >
                {event.buttonNm}
                <Box component={Icon} icon={'ep:arrow-right-bold'} sx={{ pointer: 'cursor', ml: 1 }}></Box>
              </Button>
              :
              <BootstrapTooltip title={<><span style={{ color: '#FF7F3F' }}>Î°úÍ∑∏Ïù∏</span> ÌõÑ Ï∞∏Ïó¨Í∞Ä Í∞ÄÎä•Ìï¥Ïöî</>} open={true}>
                <Button
                  variant={'contained'}
                  size={'large'}
                  sx={{
                    // backgroundColor: theme.palette.common.white,
                    height: pxToRem(60),
                    maxWidth: 'md',
                    width: '100%',
                    borderRadius: `${pxToRem(30)}  ${pxToRem(30)}  0 0 !important`,
                    position: 'fixed',
                    bottom: 0,
                    overflow: 'hidden',
                    zIndex: 4,
                    // '&:hover':{
                    //   bgcolor:alpha('#fff', 0.8),
                    //   color:theme.palette.primary.main,
                    // }
                  }}
                  onClick={getCoupon}
                >
                  {event.buttonNm}
                  <Box component={Icon} icon={'ep:arrow-right-bold'} sx={{ pointer: 'cursor', ml: 1 }}></Box>
                </Button>
              </BootstrapTooltip>
        }
      </Stack>
      {
        openLoading &&
        <Dialog
          fullWidth
          keepMounted
          maxWidth={'md'}
          open={openLoading}
          TransitionComponent={Transition}
          // hideBackdrop
          PaperProps={{
            sx: {
              p: 0,
              m: '0 !important',
              maxHeight: '100%',
              minHeight: '100%',
              borderRadius: '0 !important',
              boxShadow: 'none',
              overflowY: 'initial',
            },
          }}
          onClose={(e: any, reason: string) => {
          }}
          sx={{
            '& .MuiDialog-container': {
              overflowY: 'auto',
            },
            margin: '0 !important',
            zIndex: theme.zIndex.modal,
            padding: 0,
            borderRadius: 0,
          }}
        >
          <Stack
            sx={{
              display: 'flex',
              flex: 1,
              width: '100%',
              height: '100%',
              px: pxToRem(20),
              py: pxToRem(20),
              justifyContent: 'center',
              alignItems: 'center',
              textAlign: 'center',
              background: '#FF7F3F',
            }}
          >
            <Typography variant={'Kor_16_b'} sx={{ color: '#FFFFFF', mb: 4 }}>
              Í≤∞Í≥º ÌôïÏù∏ Ï§ëÏûÖÎãàÎã§<br />
              Ïû†ÏãúÎßå Í∏∞Îã§Î†§ Ï£ºÏÑ∏Ïöî
            </Typography>
            <Logo />
            <LinearProgress sx={{
              width: '100%', mt: 4,

              backgroundColor: '#FFFFFF',
              '& .MuiLinearProgress-bar': {
                backgroundColor: '#FFC3A5'
              }
            }} />
          </Stack>
        </Dialog>
      }
      {
        openResult &&
        <Dialog
          fullWidth
          keepMounted
          maxWidth={'md'}
          open={openResult}
          TransitionComponent={Transition}
          // hideBackdrop
          PaperProps={{
            sx: {
              p: 0,
              m: '0 !important',
              maxHeight: '100%',
              minHeight: '100%',
              borderRadius: '0 !important',
              boxShadow: 'none',
              overflowY: 'initial',
            },
          }}
          onClose={(e: any, reason: string) => {
            if (reason === 'backdropClick') {
              e.preventDefault();
              e.stopPropagation();
            } else {
              setOpenResult(false);
            }
          }}
          sx={{
            '& .MuiDialog-container': {
              overflowY: 'auto',
            },
            margin: '0 !important',
            zIndex: theme.zIndex.modal,
            padding: 0,
            borderRadius: 0,
          }}
        >
          <Prize handleClose={() => {
            setOpenResult(false);
            navigate('/', { replace: true });
          }} resultData={resultData}
          />
        </Dialog>
      }
      {
        openAlert &&
        <Dialog
          open={openAlert}
          PaperProps={{
            sx: {
              p: '25px !important',
              borderRadius: '25px !important',
              minWidth: '250px',
            },
          }}
          onClose={() => {
            setOpenAlert(false);
          }}
          sx={{
            margin: '0 !important',
            zIndex: theme.zIndex.modal,
            padding: 0,
          }}
        >
          <Typography variant="Kor_16_r" textAlign={'center'}>
            {alertMsg}
          </Typography>
          <Stack direction={'row'} display={'flex'} justifyContent={'space-between'} gap={1}>
            <Button
              fullWidth
              variant={responseStore.responseInfo.errorCode === '401' ? 'outlined' : 'contained'}
              size={'medium'}
              sx={{ mt: 3, borderRadius: 3 }}
              onClick={() => {
                setOpenAlert(false);
              }}
            >
              {responseStore.responseInfo.errorCode === '401' ? 'Ï∑®ÏÜå' : 'ÌôïÏù∏'}
            </Button>
          </Stack>
        </Dialog>
      }
    </>
  );
});

export default Fcfs;

const useStyles = makeStyles(() => ({
  couponInfo: {
    '& .MuiAccordionSummary-root': {
      p: `${pxToRem(0)} !important`,
      backgroundColor: 'none',
    },
    '& .MuiAccordionSummary-content': {
      my: `${pxToRem(12)} !important`,
    },
    '& .MuiButtonBase-root': {
      height: `${pxToRem(50)} !important`,
      minHeight: `${pxToRem(56)} !important`,
    },
    '&.MuiAccordion-root.Mui-expanded': {
      mt: 0,
      backgroundColor: alpha('#fff', 0),
      boxShadow: 'none',
    },
    '&.MuiAccordion-root.Mui-expanded:before': {
      // opacity: 1,
      backgroundColor: "none",
    },
  },
}));

const BootstrapTooltip = styled(({ className, ...props }: TooltipProps) => (
  <Tooltip {...props} arrow classes={{ popper: className }} />
))(({ theme }) => ({
  [`.${tooltipClasses.tooltip}`]: {
    borderRadius: '8px',
    bottom: '-10px',
    zIndex: 999999
  },
  [`& .${tooltipClasses.arrow}`]: {
    color: '#5D6066',
  },
  [`& .${tooltipClasses.tooltip}`]: {
    backgroundColor: '#5D6066',
  },
}));

const Transition = React.forwardRef(function Transition(
  props: TransitionProps & {
    children: React.ReactElement<any, any>;
  },
  ref: React.Ref<unknown>,
) {
  return <Slide direction="left" ref={ref} {...props} />;
});


const Accordion = styled(MuiAccrodion)(({ theme }) => ({
  '&.MuiAccordion-root': {
    border: 0,
    '&:before': {
      display: 'none',
    },
    minHeight: pxToRem(52),
    '&.Mui-expanded': {
      boxShadow: 'none',
      borderRadius: 0,
      backgroundColor: '#fff',
      minHeight: pxToRem(52),
      margin: 0,
    },
  },
}));

const AccordionDetails = styled(MuiAccordionDetails)(({ theme }) => ({
  '&.MuiAccordionDetails-root': {
    padding: `20px 0`,
    borderBottom: '1px solid #ebebeb',
    textAlign: 'left',
  },
}));

const AccordionSummary = styled(MuiAccordionSummary)(({ theme }) => ({
  '&.MuiAccordionSummary-root': {
    minHeight: pxToRem(52),
    borderBottom: '1px solid #ebebeb',
    paddingLeft: 0,
    margin: '0',
    '&.Mui-expanded': {
      minHeight: pxToRem(52),
      margin: '0',
    },
    '& .MuiAccordionSummary-content': {
      alignItems: 'center',
      margin: '12px 0',
      '&.Mui-expanded': {
        margin: '12px 0',
      },
    },
  },
}));
